# 2026-02-24 Tavily 搜索引擎集成

本次更新将 Tavily Web Search API 作为新的搜索引擎 Provider 集成到 DigEino 的 `web_search` 工具中，复用现有 SearchProvider 架构，实现与 Bocha、Firecrawl 等引擎的并列切换。

## 更新亮点

- **Tavily Search 引擎**：`web_search` 支持 `Engine: "tavily"`，面向 AI Agent 的 Web Search API，p50 延迟约 180ms。
- **配置灵活**：支持 `Tools.WebSearch.Tavily` 配置块，可设置 `SearchDepth`（basic/fast/advanced/ultra-fast）、`Topic`（general/news/finance）。
- **环境变量兜底**：支持通过 `TAVILY_API_KEY` 环境变量配置 ApiKey。

## 1. Tavily 能力概览

| 能力 | 说明 |
|------|------|
| Search | 网页搜索，支持 query、max_results、search_depth、topic、time_range、country 等 |
| Extract | 从指定 URL 提取内容（类似 firecrawl_scrape） |
| Crawl | 爬取整站 |
| Research | 深度研究任务（LLM 驱动） |

本次仅集成 **Search** 能力，Extract/Crawl/Research 可作为后续扩展。

**定价**：免费 1000 credits/月，基础搜索 1 credit/次；付费 $30/月起。

## 2. 配置方式

在 `eino.yml`（或等价配置）中：

```yaml
Tools:
  WebSearch:
    Engine: "tavily"
    Tavily:
      ApiKey: ""                    # 或环境变量 TAVILY_API_KEY
      BaseUrl: "https://api.tavily.com"
      SearchDepth: "basic"          # basic | fast | advanced | ultra-fast
      Topic: "general"              # general | news | finance
```

或通过环境变量 `TAVILY_API_KEY` 设置 ApiKey。

## 3. 实现要点

- 新增 `tools/research/websearch/tavily.go`，实现 `SearchProvider` 接口，调用 `POST https://api.tavily.com/search`。
- 请求体：`query`、`max_results`（映射 `req.MaxResults`，上限 20）、`search_depth`、`topic`；解析 `results[]` 的 `url`、`title`、`content` 映射为统一 `SearchResult` 格式（content 作为 Description）。
- `config/config.go` 新增 `TavilyConfig` 结构体及 `WebSearchConfig.Tavily` 字段。
- `web_search.go` 中增加 `case "tavily"`，从 `toolCfg.Tavily` 读取配置，支持环境变量兜底。

## 4. 相关文件

| 文件 | 说明 |
|------|------|
| `tools/research/websearch/tavily.go` | Tavily 搜索 Provider 实现 |
| `tools/research/websearch/web_search.go` | 引擎分支增加 case "tavily" |
| `config/config.go` | 新增 TavilyConfig 及 WebSearchConfig.Tavily |
| `config/config.yaml` | Tavily 配置示例 |
| `docs/research_tools_guide.md` | web_search 支持的引擎列表增加 Tavily |
| `docs/tools_info.md` | 补充 Tavily 说明及配置方式 |

## 5. 与现有引擎的对比

| 引擎 | 特点 | 适用场景 |
|------|------|----------|
| Bocha | 国内服务，中文友好 | 国内/中文搜索 |
| Firecrawl | 与 scrape 共用 ApiKey，搜索+抓取 | 已有 Firecrawl 时 |
| **Tavily** | 面向 AI、低延迟、benchmark 表现好 | 英文/国际搜索、Agent 场景 |
| SerpAPI/Google | 依赖第三方 API | 需要 Google 结果时 |

## 6. 可选扩展（后续）

- **Tavily Extract**：可类比 `firecrawl_scrape`，新增 `tavily_extract` 工具或作为抓取阶梯的 L2 备选。
- **Region/Country**：若需按国家/地区过滤，可在 `SearchRequest` 或 `TavilyConfig` 中增加 `country` 并传给 Tavily API。
